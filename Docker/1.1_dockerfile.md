### __Dockerfile__

dockerfile best practices

- https://docs.docker.com/develop/develop-images/dockerfile_best-practices/
- https://docs.docker.com/engine/reference/builder/


1. RUN: docker image build lurken çalışır
2. CMD: build işlemi bittikten sonra docker container ayağa kaltığında çalışır. Komut satırında docker image dan container ayağa kaldırılşıp çalıştırılırken cli ın ezilerek CMD dedeki komutun çalışması sağlanır. bir docker file da sadece bir adet CMD bulunmalıdır.
  
CMD birkaç farklı şekilde yazılabilir.

- CMD [ "executable", "param1", "param2" ]
- CMD [ "param1", "param2" ] // entrypoint in işaret ettiği yerde bir executable var zaten ona işaret emiş oluruz.
- CMD command param1 param2

3. ENTRYPOINT: Eğer oluşturlan image belli bir excutable un parametre alarak çalışcağı bir uygulam ise, ENTRYPOINT ilgili executable olduğu yerde bırakılırsa sadece parametre vererek container  ı ayağa kaldırmak mümkün olcaktır.

- ENTRYPOINT [ "/bin/ping" ]  // buradada bırakılırsa dockerfile içinde

aşağıdaki şekilde ping executable ı yazılmadan çağrılabilir. bu arada bestpractice bu şekilde.

- docker run ubuntu 8.8.8.8

4. ADD: image a local den dosya kopyalamak için kullanılır. COPY den farklı oarak internetteen bira adrestedn de indirebilir.
   
 - ADD ["src",... "dest"]

5. WORKDIR: aktif olarak RUN, CMD, ENTRYPOINT, COPY komutlarının çalışağı klasörü belirtir.
   
6. HEALTHCHECK :

- HEALTHCHECK --interval=5m --timeout=3s CMD curl -f http://localhost/ || exit 1

7. SHELL: 



SHELL ["executable", "parameters"]

The SHELL instruction allows the default shell used for the shell form of commands to be overridden. The default shell on Linux is ["/bin/sh", "-c"], and on Windows is ["cmd", "/S", "/C"]. The SHELL instruction must be written in JSON form in a Dockerfile.

The SHELL instruction is particularly useful on Windows where there are two commonly used and quite different native shells: cmd and powershell, as well as alternate shells available including sh.

The SHELL instruction can appear multiple times. Each SHELL instruction overrides all previous SHELL instructions, and affects all subsequent instructions. For example:




``` docker
FROM microsoft/windowsservercore

# Executed as cmd /S /C echo default
RUN echo default

# Executed as cmd /S /C powershell -command Write-Host default
RUN powershell -command Write-Host default

# Executed as powershell -command Write-Host hello
SHELL ["powershell", "-command"]
RUN Write-Host hello

# Executed as cmd /S /C echo hello
SHELL ["cmd", "/S", "/C"]
RUN echo hello
```

8. STOPSIGNAL:

STOPSIGNAL signal

The STOPSIGNAL instruction sets the system call signal that will be sent to the container to exit. This signal can be a valid unsigned number that matches a position in the kernel’s syscall table, for instance 9, or a signal name in the format SIGNAME, for instance SIGKILL.

9. ONBUILD:

An ONBUILD command executes after the current Dockerfile build completes. ONBUILD executes in any child image derived FROM the current image. Think of the ONBUILD command as an instruction the parent Dockerfile gives to the child Dockerfile.

A Docker build executes ONBUILD commands before any command in a child Dockerfile.

ONBUILD is useful for images that are going to be built FROM a given image. For example, you would use ONBUILD for a language stack image that builds arbitrary user software written in that language within the Dockerfile, as you can see in Ruby’s ONBUILD variants.

10. ENV

To make new software easier to run, you can use ENV to update the PATH environment variable for the software your container installs. For example, ENV PATH /usr/local/nginx/bin:$PATH ensures that CMD ["nginx"] just works.

The ENV instruction is also useful for providing required environment variables specific to services you wish to containerize, such as Postgres’s PGDATA.

Lastly, ENV can also be used to set commonly used version numbers so that version bumps are easier to maintain, as seen in the following example:

```docker
ENV PG_MAJOR 9.3
ENV PG_VERSION 9.3.4
RUN curl -SL http://example.com/postgres-$PG_VERSION.tar.xz | tar -xJC /usr/src/postgress && …
ENV PATH /usr/local/postgres-$PG_MAJOR/bin:$PATH
```

11. VOLUME

VOLUME ["/data"]

The VOLUME instruction creates a mount point with the specified name and marks it as holding externally mounted volumes from native host or other containers. The value can be a JSON array, VOLUME ["/var/log/"], or a plain string with multiple arguments, such as VOLUME /var/log or VOLUME /var/log /var/db. For more information/examples and mounting instructions via the Docker client, refer to Share Directories via Volumes documentation.

The docker run command initializes the newly created volume with any data that exists at the specified location within the base image. For example, consider the following Dockerfile snippet:

``` docker
FROM ubuntu
RUN mkdir /myvol
RUN echo "hello world" > /myvol/greeting
VOLUME /myvol
```

12. USER

If a service can run without privileges, use USER to change to a non-root user. Start by creating the user and group in the Dockerfile with something like RUN groupadd -r postgres && useradd --no-log-init -r -g postgres postgres.

```
FROM microsoft/windowsservercore
# Create Windows user in the container
RUN net user /add patrick
# Set it for subsequent commands
USER patrick
```



-
- https://gokhansengun.com/docker-yeni-image-hazirlama/